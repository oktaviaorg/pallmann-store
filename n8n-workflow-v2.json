{
  "name": "Pallmann Article Generator",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 8
            },
            {
              "triggerAtHour": 20
            }
          ]
        }
      },
      "id": "cron-trigger",
      "name": "Cron 8h et 20h",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [100, 300]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "https://mjuzyqhxifyvebtnlrra.supabase.co/rest/v1/pallmann_products",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            { "name": "select", "value": "id,name,slug,description,features,image_url,pdf_url" },
            { "name": "limit", "value": "1" }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            { "name": "apikey", "value": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1qdXp5cWh4aWZ5dmVidG5scnJhIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0MjgxOTMzMywiZXhwIjoyMDU4Mzk1MzMzfQ.MifUYblRmRAEIHVF1Z7aohfvR99rjVXee_-16Fvt5sY" },
            { "name": "Authorization", "value": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1qdXp5cWh4aWZ5dmVidG5scnJhIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0MjgxOTMzMywiZXhwIjoyMDU4Mzk1MzMzfQ.MifUYblRmRAEIHVF1Z7aohfvR99rjVXee_-16Fvt5sY" }
          ]
        },
        "options": {}
      },
      "id": "get-random-product",
      "name": "RÃ©cupÃ©rer produit random",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [320, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=AIzaSyDQIvQIb54_PE86eVKmtnX5mmocYMEl5NY",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"contents\": [{\n    \"parts\": [{\n      \"text\": \"Tu es Ã‰ric, technicien d'application Pallmann avec 15 ans d'expÃ©rience terrain. Tu Ã©cris pour pallmann-store.com.\\n\\nÃ‰cris un article de blog SEO-friendly sur ce produit:\\n\\nNom: {{ $json[0].name }}\\nDescription: {{ $json[0].description }}\\nCaractÃ©ristiques: {{ $json[0].features }}\\n\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\nSTYLE Ã‰DITORIAL (TRÃˆS IMPORTANT)\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\n- Parle comme un artisan passionnÃ© qui conseille un collÃ¨gue\\n- Utilise 'je', 'on', des expressions de chantier\\n- Ajoute 1-2 anecdotes terrain crÃ©dibles\\n- Ton: pro mais accessible, jamais commercial\\n- Ã‰vite le jargon marketing vide\\n\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\nSTRUCTURE ARTICLE (1000-1500 mots)\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\n\\n1. TITRE H1 - Accrocheur avec mot-clÃ© principal\\n\\n2. INTRO (2-3 paragraphes)\\n   - ProblÃ¨me concret de chantier\\n   - Pourquoi ce produit est la solution\\n\\n3. PRÃ‰SENTATION PRODUIT (h2)\\n   - Ce que c'est, pour qui\\n   - Avantages clÃ©s (liste Ã  puces)\\n\\n4. MODE OPÃ‰RATOIRE DÃ‰TAILLÃ‰ (h2)\\n   - PrÃ©paration du support\\n   - Application Ã©tape par Ã©tape\\n   - Temps de sÃ©chage\\n   - Conseils pro\\n\\n5. ERREURS CLASSIQUES (h2)\\n   - 3-4 erreurs frÃ©quentes\\n   - Comment les Ã©viter\\n\\n6. MON VERDICT (h2)\\n   - Ton avis personnel franc\\n   - Pour qui c'est fait / pas fait\\n\\n7. FAQ - QUESTIONS FRÃ‰QUENTES (h2)\\n   âš ï¸ OBLIGATOIRE - GÃ©nÃ¨re 5-6 questions/rÃ©ponses pertinentes\\n   Format: <div class=\\\"faq-item\\\"><h3>Question ?</h3><p>RÃ©ponse dÃ©taillÃ©e.</p></div>\\n   Questions types:\\n   - Combien de mÂ² avec X litres ?\\n   - Temps de sÃ©chage complet ?\\n   - Compatible avec quel type de parquet ?\\n   - Peut-on l'utiliser sur... ?\\n   - Quelle est la durÃ©e de vie ?\\n   - Entretien recommandÃ© ?\\n\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\nMISE EN FORME HTML\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\n- Utilise h2, h3, p, ul/li, strong, em\\n- Ajoute des <figure> avec images placeholder: <figure><img src=\\\"PRODUCT_IMAGE\\\" alt=\\\"description\\\"/><figcaption>lÃ©gende</figcaption></figure>\\n- Paragraphes courts (3-4 lignes max)\\n- Listes Ã  puces pour les Ã©tapes\\n- EncadrÃ©s pour les tips: <div class=\\\"tip\\\"><strong>ğŸ’¡ Astuce pro:</strong> texte</div>\\n- EncadrÃ©s warning: <div class=\\\"warning\\\"><strong>âš ï¸ Attention:</strong> texte</div>\\n\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\nRÃ‰PONSE JSON UNIQUEMENT\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\n{\\n  \\\"title\\\": \\\"Titre H1 accrocheur\\\",\\n  \\\"slug\\\": \\\"titre-en-minuscules-avec-tirets\\\",\\n  \\\"excerpt\\\": \\\"RÃ©sumÃ© accrocheur de 150 caractÃ¨res max\\\",\\n  \\\"content\\\": \\\"Article HTML complet avec FAQ intÃ©grÃ©e\\\",\\n  \\\"meta_description\\\": \\\"Description SEO de 155 caractÃ¨res max\\\",\\n  \\\"keywords\\\": [\\\"mot-clÃ©-1\\\", \\\"mot-clÃ©-2\\\", \\\"mot-clÃ©-3\\\", \\\"mot-clÃ©-4\\\", \\\"mot-clÃ©-5\\\"],\\n  \\\"faq\\\": [\\n    {\\\"question\\\": \\\"Question 1 ?\\\", \\\"answer\\\": \\\"RÃ©ponse 1\\\"},\\n    {\\\"question\\\": \\\"Question 2 ?\\\", \\\"answer\\\": \\\"RÃ©ponse 2\\\"}\\n  ]\\n}\"\n    }]\n  }],\n  \"generationConfig\": {\n    \"temperature\": 0.75,\n    \"maxOutputTokens\": 8192\n  }\n}",
        "options": {}
      },
      "id": "generate-article",
      "name": "GÃ©nÃ©rer article (Gemini)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [540, 300]
    },
    {
      "parameters": {
        "jsCode": "// Extraire le JSON de la rÃ©ponse Gemini\nconst geminiResponse = $input.first().json;\nconst text = geminiResponse.candidates[0].content.parts[0].text;\n\n// Nettoyer le JSON (enlever ```json si prÃ©sent)\nlet cleanJson = text.replace(/```json\\n?/g, '').replace(/```\\n?/g, '').trim();\n\ntry {\n  const article = JSON.parse(cleanJson);\n  const product = $('RÃ©cupÃ©rer produit random').first().json[0];\n  \n  // Remplacer le placeholder image par l'URL rÃ©elle du produit\n  if (product.image_url) {\n    article.content = article.content.replace(/PRODUCT_IMAGE/g, product.image_url);\n  }\n  \n  // GÃ©nÃ©rer le schema.org FAQ si FAQ prÃ©sente\n  if (article.faq && article.faq.length > 0) {\n    const faqSchema = {\n      \"@context\": \"https://schema.org\",\n      \"@type\": \"FAQPage\",\n      \"mainEntity\": article.faq.map(item => ({\n        \"@type\": \"Question\",\n        \"name\": item.question,\n        \"acceptedAnswer\": {\n          \"@type\": \"Answer\",\n          \"text\": item.answer\n        }\n      }))\n    };\n    article.faq_schema = JSON.stringify(faqSchema);\n  }\n  \n  // Ajouter les mÃ©tadonnÃ©es\n  article.product_id = product.id;\n  article.product_slug = product.slug;\n  article.author = 'Ã‰ric';\n  article.category_id = 1; // Blog\n  article.status = 'published';\n  article.created_at = new Date().toISOString();\n  article.image_url = product.image_url || null;\n  \n  return [{ json: article }];\n} catch (e) {\n  throw new Error('Erreur parsing JSON Gemini: ' + e.message + '\\n\\nTexte reÃ§u: ' + text.substring(0, 1000));\n}"
      },
      "id": "parse-article",
      "name": "Parser article JSON",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [760, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://mjuzyqhxifyvebtnlrra.supabase.co/rest/v1/articles",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"title\": {{ JSON.stringify($json.title) }},\n  \"slug\": {{ JSON.stringify($json.slug) }},\n  \"excerpt\": {{ JSON.stringify($json.excerpt) }},\n  \"content\": {{ JSON.stringify($json.content) }},\n  \"meta_description\": {{ JSON.stringify($json.meta_description) }},\n  \"published\": true,\n  \"category_id\": \"b32b00fb-0d4e-45f3-937f-4c3814a0d0b6\",\n  \"site\": \"pallmann-store\",\n  \"featured_image\": {{ JSON.stringify($json.image_url) }},\n  \"keywords\": {{ JSON.stringify($json.keywords || []) }}\n}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            { "name": "apikey", "value": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1qdXp5cWh4aWZ5dmVidG5scnJhIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0MjgxOTMzMywiZXhwIjoyMDU4Mzk1MzMzfQ.MifUYblRmRAEIHVF1Z7aohfvR99rjVXee_-16Fvt5sY" },
            { "name": "Authorization", "value": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1qdXp5cWh4aWZ5dmVidG5scnJhIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0MjgxOTMzMywiZXhwIjoyMDU4Mzk1MzMzfQ.MifUYblRmRAEIHVF1Z7aohfvR99rjVXee_-16Fvt5sY" },
            { "name": "Content-Type", "value": "application/json" },
            { "name": "Prefer", "value": "return=representation" }
          ]
        },
        "options": {}
      },
      "id": "publish-article",
      "name": "Publier sur Supabase",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [980, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.telegram.org/bot8396433858:AAEW-CzdczY82L2YDvWTl9_OJ0PjB72kPiw/sendMessage",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"chat_id\": \"2088880565\",\n  \"text\": \"ğŸ“ <b>Nouvel article Pallmann publiÃ©!</b>\\n\\nğŸ“Œ {{ $('Parser article JSON').first().json.title }}\\n\\nğŸ”— https://pallmann-store.com/blog/{{ $('Parser article JSON').first().json.slug }}\\n\\nâœ… FAQ intÃ©grÃ©e ({{ $('Parser article JSON').first().json.faq ? $('Parser article JSON').first().json.faq.length : 0 }} questions)\\n\\nâœï¸ Par Ã‰ric\",\n  \"parse_mode\": \"HTML\"\n}",
        "options": {}
      },
      "id": "notify-telegram",
      "name": "Notifier Julien",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1200, 300]
    }
  ],
  "connections": {
    "Cron 8h et 20h": {
      "main": [[{ "node": "RÃ©cupÃ©rer produit random", "type": "main", "index": 0 }]]
    },
    "RÃ©cupÃ©rer produit random": {
      "main": [[{ "node": "GÃ©nÃ©rer article (Gemini)", "type": "main", "index": 0 }]]
    },
    "GÃ©nÃ©rer article (Gemini)": {
      "main": [[{ "node": "Parser article JSON", "type": "main", "index": 0 }]]
    },
    "Parser article JSON": {
      "main": [[{ "node": "Publier sur Supabase", "type": "main", "index": 0 }]]
    },
    "Publier sur Supabase": {
      "main": [[{ "node": "Notifier Julien", "type": "main", "index": 0 }]]
    }
  },
  "settings": {
    "executionOrder": "v1"
  }
}
